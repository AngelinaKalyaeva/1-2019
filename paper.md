# Формирование модели непрерывного мониторинга работоспосбоности и бизнес-процессов интрнет-магазина с возможностью оперативного оповещения.  

Ключевые слова: система мониторинга, интернет-магазин, Prometheus, ClickHouse, Grafana, GraphQL  

## Аннотация  

## Введение    

С учетом современных темпов жизни необходимо обеспечение возможности постоянного контроля за показателями бизнес-процессов, например, контроль за посещаемостью интернет-магазина пользователями,за динамикой продаж,за популярностью товара и т.д. Также необходима возможность оперативного оповещения об изменении метрик для корректировки не только планов продаж и закупок, но и политики компании в целом. Помимо прочего, важно как можно раньше узнавать о возможных проблемах работоспособности интернет-магазина, которые могут привести не только к потере прибыли от несовершенных покупок на момент недоступности сервиса, но и к потере аудитории в целом.  

Таким образом, целью данной работы является формирование модели непрерывного мониторинга работоспособности и бизнес-процессов компании с возможностью оперативного оповещения.  

Для достижения поставленной цели необходимо выполнить следующие задачи:  
1. Изучить существующие подходы к мониторингу  
2. Провести обзор существующих систем мониторинга с точки зрения обозначенных критериев:
   * возможность оповещения
   * возможность обработки метрик работоспособности, например, время ответа сервера
   * возможность обработки бизнес-метрик, например, количество продаж
   * возможность расширения набора метрик
3. Выдвинуть гипотезы о формировании модели системы мониторинга бизнес-процессов и работоспособности интернет-магазина

## Сравнение аналогов   

### Принцип отбора аналогов    

В первую очередь был выполнен обзор предметной области для установления целесообразности разработки системы мониторинга. Для выбора аналогов к рассмотрению был произведен поиск в сети интернет, а также упоминания в системе поиска научных статей "Cyberleninka". Поиск аналогов проводился с использованием ключевых слов: система, сервис, мониторинг, аналитика, метрика, работоспособность, бизнес-процессы, сайт, интернет-магазин. Примеры поисковых запросов: "Сервис мониторинга работоспособности сайта", "Сервис аналитики метрик интернет-магазина". В качестве аналогов отбирались системы, которые позволяют проводить мониторинг работоспособности сайта, в частности интернет-магазина, либо системы, которые позволяют осуществлять бизнес-аналитику.  

### Аналоги 

1. #### Google Analytics
Бесплатный сервис для создания детальной статистики веб-аналитики. Данный сервис позволяет оценить количество уникальных поситителей, количество просмотренных страниц, среднее время проведенное на сайте интернет-магазина. Google analytics позволяет отслеживать и бизнес-метрики. Для интрнет-магазина доступны следующие события для анализа: добавление пользователем товара в корзину, совершение покупки и др[ссылка на документацию]. Отчеты о работе можно получать по настроенному расписанию, например, раз в день, раз в неделю, раз в месяц. Плюсом данного сервиса является возможность настраивать параметры, которые необходимо отслеживать.  

2. #### Host-tracker   
Сервис проверки доступности сайтов и серверов. Данный сервис позволяет определить доступность, а также время отклика и скорость загрузки сайта. Также данный сервис позволяет определить использование оборудования сервера. Плюсом является наличие возможности получать уведомления о проблемах посредством sms-сообщений, email-сообщений или телефонных звонков.  

3. #### Яндекс.метрика  
Инструмент веб-аналитики. Яндекс.метрика предоставляет возможность настраивать необходимые параметры для мониторинга. Данный сервис позволяет отслеживать такие параметры, как средний чек покупки,объемы продаж в денежном и количественном эквиваленте и т.д.[ссылка на документацию]  

4. #### Ping-admin  
Сервис, позволяющий осуществлять круглосуточный мониторинг доступности и работоспособности интернет-магазина. Данный сервис предоставляет возможность получать уведомления в виде сообщений или звонков в случае, когда один из сервисов на сервере стал недоступным.  

5. #### Kuoll  
Сервис мониторинга работоспособности и устранения ошибок в интрнет-магазинах. Ошибки, найденные данным сервисом группируются и отображаются в порядке частоты появления. Данный сервис имеет возможность рассылки уведомлений о критических ошибках в Slack или Telegram.  

### Критерии сравнения аналогов  

1.  #### Возможность обработки метрик работоспособности  
Возможность обработки метрик работоспособности приложения является важным критерием, так как позволяет отслеживать технические показатели, такие как, время ответа сервера, количество потребляемых ресурсов (память, CPU и др.), количество ошибок и т.д., а также выполнять их корректировку в случае необходимости.

2.  #### Возможность обработки бизнес-метрик
Возможность непрерывного мониторинга бизнес-метрик является важным критерием, потому что позволяет отслеживать изменение показателей продаж и интереса пользователей. Получение подобной информации необходимо для возможного изменения стратегии деятельности интернет-магазина с целью привлечения большей аудитории клиентов.

3.  #### Возможность оповещения 
Возможность оперативного оповещения также является одним из важнейших критериев, так как в случае обнаружения ошибок работоспособности важно как можно раньше получать информацию о возникших неполадках с целью их скорейшего устранения и минимизации возможной потери прибыли на момент недоступности интернет-магазина. Также важно своевременно получать информацию и об изменении бизнес-метрик для обеспечения возможности их оперативной корректировки.

4.  #### Возможность расширения набора метрик  
Возможность расширения набора метрик является важным критерием, так как бизнес-процессы имеют свойство постоянного изменения, в результате чего некоторые метрики устаревают и для них необходима корректировка. 

### Таблица сравнения по критериям  

|   | Google analytics | Host-tracker | Яндекс.метрика | Ping-admin | Kuoll |
|---|:-----------------|:-------------|:---------------|:-----------|:------|
|Обработка метрик работоспособности | нет | да | нет | да | да |
|Обработка бизес-метрик | да | нет | да | нет | нет |
|Возможность оповещений | нет | да | нет | да | да |
|Расширение набора метрик | да | нет | да | нет | нет |    

Таблица 1 - Сравнение аналагов по выделенным критериям  

### Выводы по итогам сравнения  

В результате обзора аналогов и сравнения их по выделенным критериям [Таблица 1] можно сделать вывод, что среди рассмотренных программных интрументов нет решения, которое удовлетворяет всем описанным выше критериям. Например, такие рассмотренные сервисы, как Яндекс.метрика и Google Analytics не имеют возможности осуществлять мониторинг работоспособности интернет-магазина. А такие сервисы, как Host-tracker, Ping-admin и Kuoll, наоборот, не имеют возможности осуществлять мониторинг бизнес-метрик. Таким образом, можно сделать вывод о целесообразности разработки приложения, способного осуществлять непрерывный мониторинг работоспособности интернет-магазина и бизнес-метрик с возможностью оперативного оповещения.

## Выбор метода решения    

Решение должно представлять собой программный продукт для мониторинга работоспособности и бизнес-процессов интернет-магазина.
Данное решение должно обладать следующими качествами:  

1. Возможность сбора и обработки метрик работоспособности интернет-магазина для поддержания постоянной доступности сервиса для пользователей.  

2. Возможность сбора и обработки бизнес-метрик для формирования граммотной стратегии продвижения интернет-магазина с целью повышения продаж и получения прибыли.  

3. Обеспечение возможности визуализации исследуемых данных для проведения дальнейшего анализа.  

4. Возможность оперативного оповещения для своевременного решения возникающих проблем и минимизации возможной потери прибыли за счет несовершенных покупок на момент недоступности интернет-магазина по какой-либо причине. А также минимизации возможного отказа от использования сервиса пользователями в будущем из-за возникающих сбоев в работе приложения, что может нести за собой репутационный ущерб.  

5. Возможность расширения существующего набора метрик, с учетом современных тенденций развития рынка.  

## Описание метода решения  
В качестве решения поставленных задач был выбран комбинированный подход. Для возможности подключения к системе мониторинга различных интернет-магазинов было принято решения о реализации некоторого программного интерфейса приложения с применением GraphQL API.  Для хранения аналитических данных была выбрана технология с использованием централизованного хранилища в виде столбачатой базы данных ClickHouse. Для хранения и обработки метрик работоспособности интернет-магазина была выбрана технология с применением базы данных временных рядов Prometheus. Для визуализации данных и оперативного оповещения о возникающий инцидентах был выбран инструмент Grafana. Предлагаемая архитектура описанного выше решения представлена на рисунке 1.  

![](https://github.com/AngelinaKalyaeva/1-2019/blob/master/%D0%B0%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0.png)  
Рисунок 1 - Архитектура системы мониторинга  

GraphQL API – технология, представленная в виде типизированного языка запросов к серверу, которая позволяет обращаться с данными по аналогии с существующими языками взаимодействия с базами данных. Выбор данной технологии обусловлен необходимостью интеграции разрабатываемой системы мониторинга с различными интернет-магазинами, что при использовании методологии REST, привело бы к необходимости постоянных доработок и поддержки описываемого решения со стороны разработчиков. GraphQL API  позволяет упрощать процесс интеграции разрабатываемой системы мониторинга бизнес-процессов и работоспособности с различными интернет-магазинами.   

ClickHouse – столбчатая система управления базами данных из семейства NoSQL Database, предназначенная специально для хранения и обработки аналитических метрик. Данное решение было выбрано для системы мониторинга, так как оно имеет SQL-подобный язык для взаимодействия. В качестве решения для обработки данных ClickHouse использует подход MapReduce, который упрощает горизонтальное масштабирование для ускорения обработки данных, что с учетом постоянных изменений тенденций рынка, а соответственно и увеличения объема обрабатываемых метрик, является существенным преимуществом.    

Prometheus – экосистема инструментов, которая включает в себя базу данных временных рядов и используется для аналитики данных, связанных с работоспособностью приложения. В состав Prometheus входят следующие компоненты: сервер, который считывает метрики и сохраняет их в базу данных, дашборд для визуализации описанных метрик, компонент для приема кратковременных процессов, менеджер уведомлений [ссылка на статью].   

Существует два подхода для сбора метрик работоспособности приложения: push и pull[ссылка на статью]. Каждый из упомянутых выше подходов используется для решения определенных задач.  

Задачи, решаемые при помощи Push-модели:  
   * Отправка данных сразу после их создания , за счет чего обеспечивается немедленное обнаружение проблемы и постоянный мониторинг
   * Доставка метрик, генерируемых кратковременными процессами, для которых может не хватить времени для обнаружения или преобразования в конфигурацию с помощью монитора на основе pull-модели.
   * Контроль отправляемых метрик с точки зрения направления и времени отправки.
   * Увеличение производительности, за счет использования UDP   
      
Задачи, решаемые при помощи Pull-модели:    
   * Репликация собираемых метрик для обеспечения надежности хранения
   * Контроль объема и подлинности собираемых метрик
   * Обеспечение отказоустойчивости за счет контроля над собираемыми метриками.
   * Мониторинг динамики ресурсов сервера, таких как потребляемые ресурсы процессора, использование дискового пространства, использование оперативной памяти и т.д.
   * Снижение нагрузки на передачу данных по сети с допустимым процентом несогласованности в метриках.  
      
Prometheus был выбран в качестве основного решения для системы мониторинга работоспособности, так как в основе этой технологии лежит Pull-модель, которая обеспечивает решение выше перечисленных проблем. В тоже время данное решение подходит для работы с кратковременными процессами, так как в Prometheus используется pushgateway, который реализует Push-модель. Возможность реализации, как Push, так и Pull-модели для мониторинга работоспособности интернет-магазина является необходимостью, так как существуют краткосрочные процессы, например, пики потребления ресурсов процессора, оперативной памяти и т.п. В тоже время основная часть отслеживанемых метрик является длительными процессами, что при использовании Pull-модели позволяет не перегружать систему мониторинга.   

Grafana – инструмент для визуализация метрик и оповещения о настроенных инцидентах. Был выбран в качестве решения одной из поставленных задач, так как объединяет в себе сразу несколько необходимых для системы мониторинга и работоспособности и бизнес-процессов интернет-магазина с возможностью оперативного оповещения функций.  

## Заключение   

## Список литературы  





